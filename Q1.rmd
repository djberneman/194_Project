---
title: "Untitled"
output: html_document
date: '2023-06-10'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
```


```{r, warning=FALSE}
library(readxl)
Project_2_Historical_Data <- read_excel("Project 2 Historical Data.xlsx", 
    sheet = "60-40 Returns Annual", range = "B10:D107")
data = Project_2_Historical_Data

for(i in 0:100){
  data[paste0("Alpha(Large Cap %) = ", i)] = NA}

for(i in 0:100){
  alpha = i/100
  for(j in 1:length(data$Date)){
    data[j,i+4]= alpha*data$`Large Cap TR`[j] + (1-alpha)*data$FIXED[j]}}

Alpha = data.frame(matrix(nrow=101, ncol=6))
colnames(Alpha) = c("Spread_Ratio", "min", "max", "Mean", "STD_DEV", "Std_29") 
Alpha$Spread_Ratio = colnames(data)[4:104]


for(i in 1:length(Alpha$Spread_Ratio)){
    Alpha[i, 2] = min(data[, i+3])
    Alpha[i, 3] = max(data[, i+3])
    Alpha[i, 4] = sum(data[,i+3])
    Alpha[i, 4] = Alpha[i, 4]/97
    Alpha[i, 5] = sqrt(var(data[, i+3]))
    Alpha[i, 6] = sqrt(var(data[29:97, i+3]))}


Returns_30yr = c(2.755,
2.954166667,
3.0975,
3.443333333,
3.4825,
4.078333333,
4.119166667,
3.941666667,
4.055,
4.073333333,
4.186666667,
4.223333333,
4.694166667,
4.9,
5.345833333,
6.1725,
6.734166667,
5.998333333,
5.796666667,
6.9875,
7.983333333,
8.213333333,
7.944166667,
7.725,
8.544166667,
9.316666667,
11.43333333,
13.56333333,
12.66333333,
11.25583333,
12.43333333,
10.70333333,
7.69,
8.609166667,
8.936666667,
8.401666667,
8.619166667,
8.085,
7.675,
6.579166667,
7.409166667,
6.8075,
6.723333333,
6.5675,
5.531666667,
5.913333333,
5.88,
5.4675,
5.405833333,
5.0325,
5.1,
4.520833333,
4.873333333,
4.796666667,
4.218333333,
4.095,
4.180833333,
3.884166667,
2.8825,
3.459166667,
3.269166667,
2.818333333,
2.58,
2.886666667,
3.095,
2.525,
1.51,
2.0475,
3.161666667
)

Returns_30yr=Returns_30yr/100

x = 1954:2022

frame = data.frame(matrix(ncol=102, nrow=69))
frame[,1] = c(seq(1954,2022))
for(i in 4:104){
  for(j in 29:97){
    z = data[j,i] - Returns_30yr[j-28]
    frame[j-28, i-2] = z/Alpha$Std_29[i-3]}}

  

vect = vector()
for(i in 2:102){
  vect = append(vect, mean(frame[, i]))}


plot(x = 0:100, y = vect, main = "Historic Sharpe Ratio", ylab="Sharpe Ratio", xlab="alpha", type = "l")

# Conditional Expectation of total return given it will be positive
Alpha["E[TR | TR > 0]"]=NA

for(i in 4:104){
  y = data.frame(data[,c(1,i)])
  y = y %>% arrange(y[,2])
  colnames(y) = c(paste0("Date",i-4), paste0(i-4, "/", 104-i))
  y = subset(y, y[,2] > 0)
  Alpha$`E[TR | TR > 0]`[i-3] = mean(y[,2])}


Alpha["E[TR | TR < 0]"]=NA

for(i in 4:104){
  y = data.frame(data[,c(1,i)])
  y = y %>% arrange(y[,2])
  colnames(y) = c(paste0("Date",i-4), paste0(i-4, "/", 104-i))
  y = subset(y, y[,2] < 0)
  Alpha$`E[TR | TR < 0]`[i-3] = mean(y[,2])}


for(i in 4:104){
  y = data.frame(data[,c(1,i)])
  y = y %>% arrange(y[,2])
  colnames(y) = c(paste0("Date",i-4), paste0(i-4, "/", 104-i))
  y = subset(y, y[,2] > 0)
  Alpha$`SD[TR | TR > 0]`[i-3] = sqrt(var(y[,2]))}

for(i in 4:104){
  y = data.frame(data[,c(1,i)])
  y = y %>% arrange(y[,2])
  colnames(y) = c(paste0("Date",i-4), paste0(i-4, "/", 104-i))
  y = subset(y, y[,2] < 0)
  Alpha$`SD[TR | TR < 0]`[i-3] = sqrt(var(y[,2]))}

install.packages("plotrix")      
library("plotrix")

Alpha = Alpha %>%
  mutate("Z-Score" = (0 - Alpha$Mean)/Alpha$STD_DEV)

Alpha = Alpha %>%
  mutate("P(TR > 0)" = pnorm(Alpha$`Z-Score`, lower.tail = FALSE))


Alpha["E[TR]"]=NA
for(i in 1:101){
  Alpha$`E[TR]` = (Alpha$`P(TR > 0)`[i] * Alpha$`E[TR | TR > 0]`[i]) + ((1 - Alpha$`P(TR > 0)`[i]) * Alpha$`E[TR | TR < 0]`[i])}

plot(x = 0:100, y = Alpha$`P(TR > 0)`, xlab="Alpha(Large Cap %)", ylab="Probability", main = "Probability Total Returns are Positive")


Conf = Alpha[c(1,4,5,7:10,12:13)]
Conf = Conf %>%
  mutate("+lower" = Conf$`E[TR | TR > 0]` - 1.96*Conf$`SD[TR | TR > 0]`)

Conf = Conf %>%
  mutate("+upper" = Conf$`E[TR | TR > 0]` + 1.96*Conf$`SD[TR | TR > 0]`)


plotCI(x = 0:100, y = Conf$`E[TR | TR > 0]`, li = Conf$`+lower`, ui = Conf$`+upper`, main="CI Assuming TR > 0", ylab="Total Return", xlab="alpha")
abline(v = 59, col = "red", lty = "dashed")
abline(h = max(Conf$`+lower`), col = "red", lty = "dashed")
mtext("max(lower bound) @ 59", side=3, line = -1, adj = 0.1, cex=.7)

library(ggplot2)

library(ggthemes)
install.packages("ggthemes")

df = data.frame(matrix(ncol=3, nrow=9797))
for(i in 0:100){
  x = i*97 + 1
  y = (1+i)*97
  df[x:y, 1] = data[,i+4]
  df[x:y, 2] = paste0(colnames(data)[i+4])}

Alpha[c("Spread_Ratio", "min", "max")][97:101,]

ggplot2::ggplot(data = df[1:1552,], mapping = aes(x=X1), freq=FALSE) + 
  geom_histogram(binwidth=0.025)+
  geom_density(col="red") +
  scale_x_continuous(name = "Total Returns",
                     breaks = seq(-0.15, 0.35, 0.1),
                     limits=c(-0.15, 0.35)) +
  scale_y_continuous(name = "Frequency") +
  ggtitle("Histograms w/ Varying Alpha") +
  scale_fill_gradient("Count", low = "blue", high = "red") +
  geom_vline(aes(xintercept = mean(df$X1), group = X2), size = 1, colour = "#FF3721",
                   linetype = "dashed") +
  facet_wrap(~X2) + 
  geom_line(aes(y = mean(df$X1)))+
  theme(strip.text = element_text(size = 10),
        axis.text = element_text(size=10),
        strip.background = element_rect())

ggplot2::ggplot(data = df[1553:3104,], mapping = aes(x=X1), freq=FALSE) + 
  geom_histogram(binwidth=0.025)+
  geom_density(col="red") +
  scale_x_continuous(name = "Total Returns",
                     breaks = seq(-0.15, 0.35, 0.1),
                     limits=c(-0.15, 0.35)) +
  scale_y_continuous(name = "Frequency") +
  scale_fill_gradient("Count", low = "blue", high = "red") +
  geom_vline(aes(xintercept = mean(df$X1), group = X2), size = 1, colour = "#FF3721",
                   linetype = "dashed") +
  facet_wrap(~X2) + 
  geom_line(aes(y = mean(df$X1)))+
  theme(strip.text = element_text(size = 10),
        axis.text = element_text(size=10),
        strip.background = element_rect())


ggplot2::ggplot(data = df[3105:4656,], mapping = aes(x=X1), freq=FALSE) + 
  geom_histogram(binwidth=0.025)+
  geom_density(col="red") +
  scale_x_continuous(name = "Total Returns",
                     breaks = seq(-0.25, 0.35, 0.1),
                     limits=c(-0.25, 0.35)) +
  scale_y_continuous(name = "Frequency") +
  scale_fill_gradient("Count", low = "blue", high = "red") +
  geom_vline(aes(xintercept = mean(df$X1), group = X2), size = 1, colour = "#FF3721",
                   linetype = "dashed") +
  facet_wrap(~X2) + 
  geom_line(aes(y = mean(df$X1)))+
  theme(strip.text = element_text(size = 10),
        axis.text = element_text(size=9),
        strip.background = element_rect())

ggplot2::ggplot(data = df[4657:6208,], mapping = aes(x=X1), freq=FALSE) + 
  geom_histogram(binwidth=0.025)+
  geom_density(col="red") +
  scale_x_continuous(name = "Total Returns",
                     breaks = seq(-0.3, 0.4, 0.15),
                     limits=c(-0.3, 0.4)) +
  scale_y_continuous(name = "Frequency") +
  scale_fill_gradient("Count", low = "blue", high = "red") +
  geom_vline(aes(xintercept = mean(df$X1), group = X2), size = 1, colour = "#FF3721",
                   linetype = "dashed") +
  facet_wrap(~X2) + 
  geom_line(aes(y = mean(df$X1)))+
  theme(strip.text = element_text(size = 10),
        axis.text = element_text(size=10),
        strip.background = element_rect())

ggplot2::ggplot(data = df[6209:7760,], mapping = aes(x=X1), freq=FALSE) + 
  geom_histogram(binwidth=0.025)+
  geom_density(col="red") +
  scale_x_continuous(name = "Total Returns",
                     breaks = seq(-0.35, 0.45, 0.15),
                     limits=c(-0.35, 0.45)) +
  scale_y_continuous(name = "Frequency") +
  scale_fill_gradient("Count", low = "blue", high = "red") +
  geom_vline(aes(xintercept = mean(df$X1), group = X2), size = 1, colour = "#FF3721",
                   linetype = "dashed") +
  facet_wrap(~X2) + 
  geom_line(aes(y = mean(df$X1)))+
  theme(strip.text = element_text(size = 10),
        axis.text = element_text(size=10),
        strip.background = element_rect())

ggplot2::ggplot(data = df[7761:9312,], mapping = aes(x=X1), freq=FALSE) + 
  geom_histogram(binwidth=0.05)+
  geom_density(col="red") +
  scale_x_continuous(name = "Total Returns",
                     breaks = seq(-0.45, 0.55, 0.2),
                     limits=c(-0.45, 0.55)) +
  scale_y_continuous(name = "Frequency") +
  scale_fill_gradient("Count", low = "blue", high = "red") +
  geom_vline(aes(xintercept = mean(df$X1), group = X2), size = 1, colour = "#FF3721",
                   linetype = "dashed") +
  facet_wrap(~X2) + 
  geom_line(aes(y = mean(df$X1)))+
  theme(strip.text = element_text(size = 10),
        axis.text = element_text(size=10),
        strip.background = element_rect())

ggplot2::ggplot(data = df[9313:9797,], mapping = aes(x=X1), freq=FALSE) + 
  geom_histogram(binwidth=0.05)+
  geom_density(col="red") +
  scale_x_continuous(name = "Total Returns",
                     breaks = seq(-0.45, 0.55, 0.2),
                     limits=c(-0.45, 0.55)) +
  scale_y_continuous(name = "Frequency") +
  scale_fill_gradient("Count", low = "blue", high = "red") +
  geom_vline(aes(xintercept = mean(df$X1), group = X2), size = 1, colour = "#FF3721",
                   linetype = "dashed") +
  facet_wrap(~X2) + 
  geom_line(aes(y = mean(df$X1)))+
  theme(strip.text = element_text(size = 10),
        axis.text = element_text(size=10),
        strip.background = element_rect())



```




```{r}
library(readxl)
data2 <- read_excel("Project 2 Historical Data.xlsx", 
    range = "A1186:P1283")

colnames(data2) = c("Year",	"Ibbotson® SBBI® US Large-Cap Stocks (Total Return)", "Ibbotson® SBBI® US Large-Cap Stocks (Income Return)",	"Ibbotson® SBBI® US Large-Cap Stocks (Capital Appreciation  Return)",	"Ibbotson® SBBI® US Small-Cap Stocks (Total Return)",	"Ibbotson® SBBI® US Long-term (20-Year) Corporate Bonds (Total Return)",	"Ibbotson® SBBI® US Long-term (20-Year) Government Bonds (Total Return)",	"Ibbotson® SBBI® US Long-term (20-Year) Government Bonds (Income Return)",	"Ibbotson® SBBI® US Long-term (20-Year) Government Bonds (Capital Appreciation Return)",	"Ibbotson® SBBI® US Long-term (20-Year)  Government Bonds (Yield)",	"Ibbotson® SBBI® US Intermediate-term (5-Year) Government Bonds (Total Return)",	"Ibbotson® SBBI® US Intermediate-term (5-Year) Government Bonds (Income Return)",	"Ibbotson® SBBI® US Intermediate-term (5-Year) Government Bonds (Capital Appreciation Return)",	"Ibbotson® SBBI® US Intermediate-term (5-Year) Government Bonds (Yield)",	"Ibbotson® SBBI® US (30-Day) Treasury Bills",	"Ibbotson® SBBI® US Inflation")

data2 = data2[, c(1,2,6,7,11,16)]


data3 = data.frame(matrix(ncol=6, nrow=97))
colnames(data3) = colnames(data2)
data3$Year = data2$Year

data3$`Ibbotson® SBBI® US Inflation`[97] = 1 + data2$`Ibbotson® SBBI® US Inflation`[97]

for(i in 96:1){
  data3$`Ibbotson® SBBI® US Inflation`[i] = data3$`Ibbotson® SBBI® US Inflation`[i+1] * (1 + data2$`Ibbotson® SBBI® US Inflation`[i])
}

for(i in 2:5){
  for(j in 1:97){
    data3[j,i] = data2[j,i] * data3$`Ibbotson® SBBI® US Inflation`[i]}}

data3 = data.frame(matrix(ncol=6, nrow=97))

Conf2a = data.frame(matrix(nrow=97, ncol=102))
colnames(Conf2a) = c("Year", colnames(data)[4:104])

Conf2b = data.frame(matrix(nrow=97, ncol=102))
colnames(Conf2b) = c("Year", colnames(data)[4:104])

for(i in 0:100){
  alpha = i
  alpha = alpha/100
  for(j in 1:97){
    TR = alpha * data2$`Ibbotson® SBBI® US Large-Cap Stocks (Total Return)`[]
}

```
